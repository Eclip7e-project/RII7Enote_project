<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RII7E Sticky Notes Project</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
  <style>
    :root{
      --gold:#d4af37;
      --bg:#000;
      --panel:#111;
      --muted:#ddd;
    }
    html,body{margin:0;padding:0;background:var(--bg); color:#fff;font-family:'Playfair Display',serif;}
    header{display:flex;flex-direction:column;align-items:center;background:#000;border-bottom:3px solid var(--gold);}
    header img.banner{width:100%;height:auto;object-fit:contain;background:#000;display:block;}
    .header-text{padding:18px 20px;text-align:center;}
    .header-text h1{color:var(--gold);font-size:2.4rem;margin:8px 0;text-shadow:2px 2px 6px rgba(0,0,0,.6)}
    .header-text p{max-width:820px;margin:0 auto;color:#fff;font-size:1rem;line-height:1.45;text-shadow:1px 1px 3px rgba(0,0,0,.6)}
    nav{background:var(--panel);border-bottom:2px solid var(--gold); display:flex; justify-content:center; flex-wrap:wrap; padding:12px 10px; position:sticky; top:0; z-index:40;}
    nav a{color:var(--gold); text-decoration:none; margin:6px 12px; font-weight:600;}
    nav a:hover{color:#fff;text-decoration:underline;}
    main{padding:28px;}
    h2{color:var(--gold); text-align:center; margin:8px 0 18px;}
    .member-section{margin-top:34px; text-align:center;}
    .member-section h3{margin-bottom:12px;color:var(--muted);letter-spacing:1px;}
    .wall{display:flex;flex-wrap:wrap;justify-content:center;gap:18px;}
    .sticky-note{width:150px;min-height:150px;background:#fff;border-radius:12px;padding:8px;box-shadow:0 6px 18px rgba(0,0,0,.6);position:relative;cursor:pointer;overflow:hidden;display:flex;align-items:center;justify-content:center;}
    .sticky-note img{width:100%;height:100%;object-fit:cover;border-radius:8px;display:block;}
    .sticky-note .label{position:absolute;bottom:6px;left:8px;right:8px;font-size:12px;color:#111;background:rgba(255,255,255,.85);padding:4px;border-radius:6px;text-align:center}
    #simple-notes .sticky-note{width:110px;height:110px}
    .design-container img{width:100px;border-radius:10px;border:2px solid; margin:6px;}
    .design-container div{display:inline-block;position:relative;margin:6px;}
    #info-section{padding:36px;background:var(--panel);border-radius:12px;margin:40px auto 0;max-width:980px;border-top:2px solid var(--gold);}
    #info-section h2{color:var(--gold);margin-bottom:14px;}
    #info-section ul{padding-left:22px;color:#fff;}
    .btn-placeholder{display:inline-block;margin-top:14px;padding:10px 16px;background:var(--gold);color:#000;border-radius:8px;text-decoration:none;font-weight:700;}
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:60;align-items:center;justify-content:center;padding:24px}
    .modal-content{background:#fff;color:#000;border-radius:12px;max-width:820px;width:100%;padding:18px;position:relative;overflow:hidden}
    .close{position:absolute;right:14px;top:10px;font-size:26px;cursor:pointer}
    .modal-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .modal-left{position:relative;border-radius:8px;overflow:hidden}
    .modal-left img{width:100%;height:100%;object-fit:contain;display:block;border-radius:8px}
    .preview-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:12px;pointer-events:none;text-align:center}
    .preview-overlay .preview-text{font-size:1.1rem; font-weight:700; text-shadow: 1px 1px 3px rgba(0,0,0,.6); word-break:break-word}
    .modal-right label{display:block;margin-top:8px;font-weight:600}
    .modal-right textarea{width:100%;min-height:120px;padding:8px;border-radius:8px;border:1px solid #ccc;resize:none}
    .modal-right input[type="color"]{height:40px;width:56px;border:none;padding:0;margin-top:6px}
    .modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}
    .btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .btn-submit{background:var(--gold);font-weight:700}
    .btn-cancel{background:#eee;color:#111}
    @media (max-width:800px){
      .modal-grid{grid-template-columns:1fr; max-height:85vh; overflow:auto}
    }
  </style>
  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCM69r2wUibBFIFpML07Y5RUTrxHgonlSc",
      authDomain: "rii7e-sticky-notes-project.firebaseapp.com",
      projectId: "rii7e-sticky-notes-project",
      storageBucket: "rii7e-sticky-notes-project.appspot.com",
      messagingSenderId: "962319162792",
      appId: "1:962319162792:web:8fad2b11c316766c8a119d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const members = [
      {name:'shotaro', color:'#8B0000'},
      {name:'eunseok', color:'#D3D3D3'},
      {name:'sungchan', color:'#008000'},
      {name:'wonbin', color:'#FF0000'},
      {name:'seunghan', color:'#0000FF'},
      {name:'sohee', color:'#FFFF00'},
      {name:'anton', color:'#1E3A5F'},
      {name:'rii7e', color:'#FFA500'},
      {name:'brii7e', color:'#FFA500'}
    ];

    function $(s){return document.querySelector(s)}
    function $all(s){return Array.from(document.querySelectorAll(s))}

    const modal = $('#modal');
    const modalClose = $('#modal-close');
    const modalCancel = $('#modal-cancel');
    const modalImg = $('#modal-img');
    const modalMemberTitle = $('#modal-member');
    const previewText = $('#preview-text');
    const previewOverlay = $('#preview-overlay');
    const noteText = $('#note-text');
    const colorPicker = $('#color-picker');
    const memberSelect = $('#member-select');
    const memberSelectLabel = $('#member-select-label');
    const modalSubmit = $('#modal-submit');
    const designFileInput = $('#design-file');
    const designMember = $('#design-member');
    const submitDesignBtn = $('#submitDesign');
    const designMsg = $('#design-msg');
    const designContainer = $('#designContainer');

    let currentImg = '';
    let currentMember = '';
    let currentMode = 'member';

    function genID(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,6) }
    function getMemberColor(name){
      const m = members.find(x=>x.name===name);
      return m ? m.color : '#ccc';
    }

    async function renderSelectionWall(memberName){
      const wall = document.querySelector(`#${memberName}-selection .wall`);
      if(!wall) return;
      wall.innerHTML = '';

      // Load default images
      for(let i=1;i<=4;i++){
        const imgFile = `${memberName}${i}.png`;
        const note = document.createElement('div');
        note.className='sticky-note';
        note.style.border=`4px solid ${getMemberColor(memberName)}`;
        note.innerHTML=`<img src="${imgFile}" alt="${memberName} placeholder ${i}">`;
        note.onclick=()=>openModalForMember(memberName,imgFile);
        wall.appendChild(note);
      }

      // Load custom designs from localStorage
      const designs = JSON.parse(localStorage.getItem(memberName+'_designs')||'[]');
      designs.forEach(src=>{
        const note = document.createElement('div');
        note.className='sticky-note';
        note.style.border=`4px solid ${getMemberColor(memberName)}`;
        note.innerHTML=`<img src="${src}" alt="Uploaded design">`;
        note.onclick=()=>openModalForMember(memberName,src);
        wall.appendChild(note);
      });

      // Load notes from Firestore
      const q = query(collection(db, memberName), orderBy('timestamp'));
      const snapshot = await getDocs(q);
      snapshot.forEach(doc=>{
        const data = doc.data();
        const note = document.createElement('div');
        note.className='sticky-note';
        note.style.border=`4px solid ${getMemberColor(memberName)}`;
        note.innerHTML=`<div style="color:${data.color};text-align:center;word-break:break-word;">${data.text}</div>`;
        wall.appendChild(note);
      });
    }

    function renderAllSelectionWalls(){ members.forEach(m=>renderSelectionWall(m.name)) }

    function renderSimpleNotes(){
      const wall = $('#simple-note-wall');
      wall.innerHTML='';
      const colors = ['red','orange','yellow','green','blue','indigo','violet'];
      colors.forEach((color,i)=>{
        const imgFile = color+'note.png';
        const note = document.createElement('div');
        note.className='sticky-note';
        note.style.width='110px'; note.style.height='110px'; note.style.border=`3px solid #ccc`;
        note.innerHTML=`<img src="${imgFile}" alt="Simple note ${i+1}" data-color="${color}">`;
        note.onclick=()=>openModalForSimple(imgFile);
        wall.appendChild(note);
      });
    }

    function openModalForMember(memberName,imgSrc){
      currentMember=memberName; currentImg=imgSrc; currentMode='member'; setupModal();
    }

    function openModalForSimple(imgSrc){
      currentMember='simple'; currentImg=imgSrc; currentMode='simple'; setupModal();
    }

    function setupModal(){
      modalImg.src=currentImg;
      if(currentMode==='simple'){
        modalMemberTitle.textContent='Plain Note';
        memberSelect.style.display='block';
        memberSelectLabel.style.display='block';
        memberSelect.value='shotaro';
      } else {
        modalMemberTitle.textContent=currentMember.toUpperCase();
        memberSelect.style.display='none';
        memberSelectLabel.style.display='none';
      }
      previewText.textContent=''; previewText.style.color=colorPicker.value||'#000';
      noteText.value='';
      previewOverlay.style.display='flex';
      const modalLeft=$('#modal-left');
      modalLeft.style.width='150px'; modalLeft.style.height='150px';
      modal.style.display='flex'; modal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden';
    }

    function closeModal(){ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }

    noteText.addEventListener('input',e=>{previewText.textContent=e.target.value});
    colorPicker.addEventListener('input',e=>{previewText.style.color=e.target.value});

    modalClose.onclick=closeModal;
    modalCancel.onclick=closeModal;
    window.addEventListener('keydown',(e)=>{if(e.key==='Escape')closeModal()});
    modal.addEventListener('click',(e)=>{if(e.target===modal)closeModal()});

    modalSubmit.addEventListener('click',async ()=>{
      const text=noteText.value.trim(); if(!text){alert('Write something!'); return;}
      const color=colorPicker.value||'#000000';
      const member=currentMode==='simple'?memberSelect.value:currentMember;
      await addDoc(collection(db, member), { text, color, timestamp: new Date() });
      closeModal();
      alert(`Sticky note added for ${member}!`);
      renderSelectionWall(member);
    });

    submitDesignBtn.addEventListener('click',()=>{
      const file=designFileInput.files[0];
      if(!file){designMsg.textContent='Please select a file'; return;}
      const reader=new FileReader();
      reader.onload=(e)=>{
        const dataURL=e.target.result;
        const designs=JSON.parse(localStorage.getItem(designMember.value+'_designs')||'[]');
        designs.push(dataURL);
        localStorage.setItem(designMember.value+'_designs',JSON.stringify(designs));
        designMsg.textContent='Design uploaded!';
        renderSelectionWall(designMember.value);
      };
      reader.readAsDataURL(file);
    });

    window.onload=()=>{
      renderAllSelectionWalls();
      renderSimpleNotes();
      // Populate member selects
      members.forEach(m=>{
        const option=document.createElement('option'); option.value=m.name; option.textContent=m.name;
        memberSelect.appendChild(option);
        const opt2=document.createElement('option'); opt2.value=m.name; opt2.textContent=m.name;
        designMember.appendChild(opt2);
      });
    }
  </script>
</head>
<body>
  <header>
    <img class="banner" src="banner.png" alt="Banner">
    <div class="header-text">
      <h1>RII7E Sticky Notes Project</h1>
      <p>Welcome to our interactive sticky notes wall. Click any note to write your thoughts and save them in real-time!</p>
    </div>
  </header>
  <nav>
    <a href="#simple-notes">Simple Notes</a>
    <a href="#members">Members</a>
    <a href="#info-section">Info</a>
  </nav>
  <main>
    <section id="simple-notes">
      <h2>Simple Notes</h2>
      <div id="simple-note-wall" class="wall"></div>
    </section>
    <section id="members">
      <h2>Members</h2>
      ${members.map(m=>`
      <div class="member-section" id="${m.name}-selection">
        <h3>${m.name.toUpperCase()}</h3>
        <div class="wall"></div>
      </div>`).join('')}
    </section>
    <section id="info-section">
      <h2>Information</h2>
      <ul>
        <li>All notes are stored in real-time with Firebase Firestore.</li>
        <li>Upload custom designs for each member.</li>
        <li>Use the color picker to style your notes.</li>
      </ul>
    </section>
  </main>
  <!-- Modal -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <span class="close" id="modal-close">&times;</span>
      <div class="modal-grid">
        <div class="modal-left" id="modal-left">
          <img id="modal-img" src="" alt="">
          <div class="preview-overlay" id="preview-overlay">
            <div class="preview-text" id="preview-text"></div>
          </div>
        </div>
        <div class="modal-right">
          <h3 id="modal-member"></h3>
          <label for="note-text">Note Text:</label>
          <textarea id="note-text"></textarea>
          <label for="color-picker">Color:</label>
          <input type="color" id="color-picker" value="#000000">
          <label id="member-select-label" for="member-select">Select Member:</label>
          <select id="member-select"></select>
          <div class="modal-actions">
            <button class="btn btn-cancel" id="modal-cancel">Cancel</button>
            <button class="btn btn-submit" id="modal-submit">Add Note</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Design Upload -->
  <section id="design-upload" style="text-align:center;margin-top:32px;">
    <h2>Upload Design</h2>
    <input type="file" id="design-file">
    <select id="design-member"></select>
    <button id="submitDesign" class="btn btn-submit">Upload</button>
    <p id="design-msg" style="color:var(--gold);margin-top:6px;"></p>
  </section>
</body>
</html>

