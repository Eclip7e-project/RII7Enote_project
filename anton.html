<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anton Wall - RII7E Project</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Playfair Display', serif;
  background-color:black;
  background-image:url('https://www.transparenttextures.com/patterns/stardust.png');
  color:white;
  margin:0;
  padding:0;
  text-align:center;
}
header {
  display: flex;
  flex-direction: column;
  align-items: center;
  background: black;
  border-bottom: 2px solid gold;
}
header img.banner {
  width: 100%;
  height: auto; 
  object-fit: contain;
  border-bottom: 2px solid gold;
  display: block;
  margin: 0 auto;
}
.header-text {
  text-align: center;
  padding: 20px;
}
.header-text h1 { font-size: 2.5rem; color: gold; margin: 10px 0; text-shadow: 2px 2px 5px rgba(0,0,0,0.7);}
.header-text p { max-width: 700px; font-size: 1rem; margin: 0 auto; color: white; text-shadow: 1px 1px 3px rgba(0,0,0,0.7);}
section.wall {
  display:flex;
  flex-wrap:wrap;
  justify-content:flex-start;
  gap:20px;
  padding:40px;
}
.sticky-note {
  width:200px; 
  height:150px; 
  background:white; 
  border-radius:15px;
  padding:10px; 
  position:relative; 
  box-shadow:3px 3px 10px rgba(0,0,0,0.5);
  display:flex; 
  flex-direction:column; 
  align-items:center;
  cursor:pointer;
}
.sticky-note img {width:100%; border-radius:10px;}
.sticky-note .text {position:absolute; top:10px; left:10px; right:10px; bottom:30px; overflow-wrap: break-word; color:black; font-size:0.9em; white-space:pre-wrap;}
.frame {border:5px solid #1E3A5F; border-radius:15px; background:white;}
.like-btn {
  position:absolute;
  bottom:5px;
  left:50%;
  transform:translateX(-50%);
  padding:5px 10px; 
  cursor:pointer;
  background:gold; 
  border:none; 
  border-radius:5px; 
  color:black; 
  font-weight:bold;
}
.delete-btn {
  position:absolute;
  top:5px;
  right:5px;
  background:red;
  color:white;
  border:none;
  border-radius:5px;
  padding:3px 7px;
  cursor:pointer;
}
.top-note { border: 5px solid gold; box-shadow: 0 0 15px gold;}
footer { padding:30px 0; border-top:2px solid gold; margin-top:50px;}
footer a {color:gold; text-decoration:none;}
footer a:hover{text-decoration:underline;}
/* Modal */
.modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.75); z-index:60; align-items:center; justify-content:center; }
.modal-content { background:#fff; color:#000; border-radius:12px; max-width:500px; width:90%; padding:20px; position:relative; }
.modal-content img { width:100%; border-radius:12px; }
.modal-content .modal-text { margin-top:10px; color:black; text-align:left; }
.close { position:absolute; right:10px; top:10px; font-size:26px; cursor:pointer; }
</style>
</head>
<body>

<header>
  <img src="antonbanner.jpg" alt="Anton Banner" class="banner">
  <div class="header-text">
    <h1>Anton Wall</h1>
    <p>All submitted sticky notes for Anton. Give love by clicking ❤!</p>
    <a href="index.html" style="color:gold; text-decoration:underline; margin-top:10px; display:inline-block;">← Back to Homepage</a>
  </div>
</header>

<section class="wall" id="anton-wall"></section>

<footer>
  <p>Created by <a href="https://x.com/Eclip7e_project" target="_blank">@Eclip7e_project</a></p>
  <img src="logo.png" alt="Logo" height="80">
</footer>

<!-- Modal for full view -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close" id="modal-close">&times;</span>
    <img id="modal-img" src="" alt="Sticky note full view">
    <div class="modal-text" id="modal-text"></div>
    <button class="like-btn" id="modal-like">❤ 0</button>
    <button class="delete-btn" id="modal-delete" style="display:none;">Delete</button>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCM69r2wUibBFIFpML07Y5RUTrxHgonlSc",
  authDomain: "rii7e-sticky-notes-project.firebaseapp.com",
  projectId: "rii7e-sticky-notes-project",
  storageBucket: "rii7e-sticky-notes-project.firebasestorage.app",
  messagingSenderId: "962319162792",
  appId: "1:962319162792:web:8fad2b11c316766c8a119d"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const wall = document.getElementById('anton-wall');
const modal = document.getElementById('modal');
const modalImg = document.getElementById('modal-img');
const modalText = document.getElementById('modal-text');
const modalLike = document.getElementById('modal-like');
const modalDelete = document.getElementById('modal-delete');
const modalClose = document.getElementById('modal-close');

let currentNoteId = null;
let currentUserId = localStorage.getItem('userId') || (localStorage.setItem('userId', crypto.randomUUID()), localStorage.getItem('userId'));

// Load notes from Firebase
const notesRef = ref(db, 'anton/notes');
onValue(notesRef, snapshot => {
  wall.innerHTML = '';
  const data = snapshot.val() || {};
  let maxLikes = -1, topId = null;
  Object.keys(data).forEach(id => {
    const note = data[id];
    if(note.likes > maxLikes) { maxLikes = note.likes; topId = id; }
  });
  Object.keys(data).forEach(id => {
    const note = data[id];
    const div = document.createElement('div');
    div.className = 'sticky-note frame';
    if(id===topId) div.classList.add('top-note');
    div.innerHTML = `<img src="${note.img}" alt="Sticky note"><div class="text">${note.text}</div><button class="like-btn">❤ ${note.likes}</button>`;
    div.onclick = () => openModal(id, note);
    wall.appendChild(div);
  });
});

// Open modal
function openModal(id, note){
  currentNoteId = id;
  modalImg.src = note.img;
  modalText.textContent = note.text;
  modalLike.textContent = '❤ ' + note.likes;
  modalDelete.style.display = (note.userId===currentUserId)?'inline-block':'none';
  modal.style.display = 'flex';
}

// Close modal
modalClose.onclick = ()=>{ modal.style.display='none'; }
window.onclick = e=>{ if(e.target===modal) modal.style.display='none'; }

// Like button
modalLike.onclick = ()=>{
  const noteRef = ref(db, 'anton/notes/' + currentNoteId);
  onValue(noteRef, snap=>{
    const note = snap.val();
    if(!note.likedBy) note.likedBy = [];
    if(note.likedBy.includes(currentUserId)) { alert("Already liked!"); return; }
    note.likes = (note.likes||0)+1;
    note.likedBy.push(currentUserId);
    update(noteRef, note);
    modalLike.textContent = '❤ ' + note.likes;
  }, {onlyOnce:true});
}

// Delete button
modalDelete.onclick = ()=>{
  if(confirm("Delete your note?")){
    remove(ref(db, 'anton/notes/' + currentNoteId));
    modal.style.display='none';
  }
}
</script>

</body>
</html>
